name: PR í…œí”Œë¦¿ ì •ë¦¬ ìë™í™”

on:
  pull_request:
    types: [ready_for_review, reopened]

jobs:
  cleanup-pr-description:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      contents: write
    steps:
      - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4

      - name: Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: PRì— ì •ë¦¬ ì•ˆë‚´ ëŒ“ê¸€ ì¶”ê°€
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { owner, repo, number } = context.issue;
            
            github.rest.issues.createComment({
              owner,
              repo,
              issue_number: number,
              body: 'ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹\n\n10ë¶„ ì´ë‚´ì— ë‚´ìš©ì„ ì‘ì„±í•˜ì§€ ì•Šì€ ì„¹ì…˜ë“¤ì€ ìë™ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤. ì‘ì„±ì„ ì™„ë£Œí•˜ì‹  ì„¹ì…˜ì˜ ê°€ì´ë“œ ì½”ë©˜íŠ¸(`>` ë¡œ ì‹œì‘í•˜ëŠ” ì¤„)ë„ ìë™ìœ¼ë¡œ ì •ë¦¬ë©ë‹ˆë‹¤. í•„ìš”í•œ ì •ë³´ë¥¼ ëª¨ë‘ ì‘ì„±í•´ì£¼ì„¸ìš”!'
            });

      - name: 10ë¶„ ëŒ€ê¸°
        run: sleep 600

      - name: PR ì„¤ëª… ì •ë¦¬ ìˆ˜í–‰
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { owner, repo, number } = context.issue;
            
            // í˜„ì¬ PR ì„¤ëª… ê°€ì ¸ì˜¤ê¸°
            const pr = await github.rest.pulls.get({
              owner,
              repo,
              pull_number: number
            });
            
            let description = pr.data.body;
            if (!description) return;
            
            // ê° ì„¹ì…˜ ì²˜ë¦¬
            const sections = description.split(/^## /m);
            const processedSections = [];
            
            // ì²« ## ì´ì „ í…ìŠ¤íŠ¸ê°€ ìˆìœ¼ë©´ ìœ ì§€
            if (sections[0] && !sections[0].startsWith('#')) {
              processedSections.push(sections[0]);
            }
            
            // ê° ì œëª©ê³¼ í•¨ê»˜ ì„¹ì…˜ ì²˜ë¦¬
            for (let i = 1; i < sections.length; i++) {
              const section = sections[i];
              const lines = section.split('\n');
              const heading = lines[0];
              const content = lines.slice(1).join('\n');
              
              // ë¹ˆ ì„¹ì…˜ì´ë‚˜ ê°€ì´ë“œ ì½”ë©˜íŠ¸ë§Œ ìˆëŠ” ì„¹ì…˜ ê±´ë„ˆë›°ê¸°
              const contentWithoutGuides = content.replace(/^> .*$/gm, '').trim();
              if (!contentWithoutGuides) {
                continue; // ì´ ì„¹ì…˜ ê±´ë„ˆë›°ê¸°
              }
              
              // ë‚´ìš©ì´ ìˆëŠ” ì„¹ì…˜ì˜ ê°€ì´ë“œ ì½”ë©˜íŠ¸ ì œê±°
              const cleanedContent = content.split('\n')
                .filter(line => !line.trim().startsWith('> '))
                .join('\n');
              
              processedSections.push(`## ${heading}${cleanedContent}`);
            }
            
            // PR ì„¤ëª… ì—…ë°ì´íŠ¸
            const newDescription = processedSections.join('');
            
            await github.rest.pulls.update({
              owner,
              repo,
              pull_number: number,
              body: newDescription
            }); 